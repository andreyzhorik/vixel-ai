<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>NOT AI â€” GPTS</title>
<style>
  :root{
    --bg:#0a0f1c; --panel:#10182a; --accent:#3b82f6; --accent-soft:#1d4ed8;
    --muted:#94a3b8; --text:#e5eaf5; --radius:14px; --shadow:0 10px 30px rgba(0,0,0,.3);
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
  }
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;
    background:linear-gradient(180deg,var(--bg),#060b17);color:var(--text)}
  .app{width:95%;max-width:900px;height:90vh;background:var(--panel);border-radius:var(--radius);
    box-shadow:var(--shadow);display:flex;flex-direction:column;overflow:hidden;border:1px solid rgba(255,255,255,0.04)}
  header{display:flex;align-items:center;justify-content:space-between;padding:18px;border-bottom:1px solid rgba(255,255,255,0.04)}
  .brand{display:flex;gap:12px;align-items:center}
  .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-soft));
    display:flex;align-items:center;justify-content:center;font-weight:800;color:#fff}
  .title{font-weight:700;color:var(--accent)}
  .controls{display:flex;gap:10px;align-items:center}
  select{background:rgba(255,255,255,0.03);color:var(--text);border:1px solid rgba(255,255,255,0.06);
    padding:8px 10px;border-radius:10px;font-weight:600;cursor:pointer}
  .btn{background:var(--accent);border:none;color:#fff;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:700}
  .chat{flex:1;overflow:auto;padding:20px;display:flex;flex-direction:column;gap:12px}
  .msg{max-width:78%;padding:12px 16px;border-radius:12px;line-height:1.5;box-shadow:0 6px 18px rgba(0,0,0,0.3)}
  .msg.user{align-self:flex-end;background:linear-gradient(135deg,var(--accent-soft),var(--accent));color:#fff;border-bottom-right-radius:6px}
  .msg.assistant{align-self:flex-start;background:#111827;color:var(--text);border-bottom-left-radius:6px}
  .msg strong{color:#fff;font-weight:700}
  .meta{font-size:12px;color:var(--muted);margin-top:6px}
  footer{display:flex;gap:10px;padding:14px;border-top:1px solid rgba(255,255,255,0.04);background:#0d1525}
  textarea{flex:1;min-height:56px;border-radius:10px;padding:12px;background:#0c1222;border:1px solid rgba(255,255,255,0.06);color:var(--text);resize:none}
  button.send{background:var(--accent);color:#fff;border:none;padding:12px 18px;border-radius:10px;font-weight:700;cursor:pointer}
  .small{font-size:12px;color:var(--muted)}
  .typing{width:48px;height:18px;border-radius:12px;background:#162037;display:flex;gap:6px;align-items:center;padding:6px}
  .dot{width:8px;height:8px;border-radius:50%;background:var(--muted);animation:blink 1s infinite}
  .dot:nth-child(2){animation-delay:.15s}.dot:nth-child(3){animation-delay:.3s}
  @keyframes blink{0%{opacity:.15}50%{opacity:1}100%{opacity:.15}}
  @media (max-width:640px){.app{height:100vh;border-radius:0}}
</style>
</head>
<body>
  <div class="app" role="application" aria-label="NOT AI chat UI">
    <header>
      <div class="brand">
        <div class="logo">N-A</div>
        <div>
          <div class="title">NOT AI</div>
          <div class="small">Local & Private Chat UI</div>
        </div>
      </div>

      <div class="controls">
        <label class="small" for="provider">Model</label>
        <select id="provider" title="Choose model"></select>
        <button class="btn" id="clearBtn" title="Clear chat">Clear</button>
      </div>
    </header>

    <main class="chat" id="chat" aria-live="polite"></main>

    <footer>
      <textarea id="prompt" placeholder="Type your message..." aria-label="Message input"></textarea>
      <button class="send" id="sendBtn">Send</button>
    </footer>
  </div>

<script>
(() => {
  /* ===== CONFIG ===== */
  const PRIMARY_API = "https://plain-pine-b32a.mrviktor2426.workers.dev/"; // main
  const BACKUP_API  = "https://wispy-voice-741d.mrviktor2426.workers.dev/"; // backup

  const providerSel = document.getElementById("provider");
  const chatEl = document.getElementById("chat");
  const promptEl = document.getElementById("prompt");
  const sendBtn = document.getElementById("sendBtn");
  const clearBtn = document.getElementById("clearBtn");

  // Fill model dropdown
  if (providerSel) {
    providerSel.innerHTML = `
      <option value="gpt-4o-mini" data-locked="false">GPT-4o-mini (free and good thinking)</option>
      <option value="gpt-4o" data-locked="true">GPT-4o (locked and good for everything)</option>
      <option value="gpt-4.1-mini" data-locked="true">GPT-4.1-mini (locked and good for school)</option>
      <option value="gemini-2.5-flash" data-locked="false">Gemini 2.5 Flash (free)</option>
      <option value="deepseek" data-locked="false">DeepSeek (free)</option>
    `;
  }

  /* === CREATE MESSAGE ELEMENT === */
  function nodeMsg(text, role = "assistant") {
    const div = document.createElement("div");
    div.className = "msg " + (role === "user" ? "user" : "assistant");

    // âœ… Bold markdown-like **text** + line breaks
    let html = text
      .replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>")
      .replace(/\n/g, "<br>");

    div.innerHTML = html;
    return div;
  }

  function append(node) {
    chatEl.appendChild(node);
    chatEl.scrollTop = chatEl.scrollHeight;
  }

  function showTyping() {
    if (document.getElementById("typingIndicator")) return;
    const wrap = document.createElement("div");
    wrap.className = "msg assistant";
    wrap.id = "typingIndicator";
    wrap.innerHTML = '<div class="typing"><span class="dot"></span><span class="dot"></span><span class="dot"></span></div>';
    append(wrap);
  }

  function hideTyping() {
    const el = document.getElementById("typingIndicator");
    if (el) el.remove();
  }

  async function callWorker(baseUrl, provider, messages) {
    try {
      const res = await fetch(baseUrl, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ provider, messages }),
      });
      const txt = await res.text();
      try {
        return JSON.parse(txt);
      } catch {
        return { error: txt };
      }
    } catch (err) {
      return { error: { message: err.message || String(err) } };
    }
  }

  async function sendMessage(text) {
    const model = providerSel?.value || "gpt-4o-mini";
    append(nodeMsg(text, "user"));
    showTyping();

    let resp = await callWorker(PRIMARY_API, model, [{ role: "user", content: text }]);

    if (resp.error) {
      append(nodeMsg("âš ï¸ Primary failed, trying backup...", "assistant"));
      resp = await callWorker(BACKUP_API, "gpt-4o-mini", [{ role: "user", content: text }]);
    }

    hideTyping();
    if (resp.error) {
      append(nodeMsg("âŒ Error: " + JSON.stringify(resp.error), "assistant"));
      return;
    }

    const reply = resp.choices?.[0]?.message?.content || resp.output_text || "âš ï¸ No reply";
    append(nodeMsg(reply, "assistant"));
  }

  sendBtn.addEventListener("click", async () => {
    const t = promptEl.value.trim();
    if (!t) return;
    promptEl.value = "";
    await sendMessage(t);
  });

  promptEl.addEventListener("keydown", (e) => {
    if (e.key === "Enter" && !e.shiftKey) {
      e.preventDefault();
      sendBtn.click();
    }
  });

  clearBtn.addEventListener("click", () => (chatEl.innerHTML = ""));

  // Startup message
  (function startHint() {
    const intro = nodeMsg("ðŸ‘‹ Welcome to **NOT AI** â€” Choose a model and start chatting!\nLocked ones need invite codes.");
    append(intro);
  })();
})();
</script>
</body>
</html>
